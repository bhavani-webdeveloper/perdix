import java.time.*;

    loanAccount = loanAccountRepository.findById(loanId);
    loanProduct = loanProductRepository.findByProductCode(loanAccount.getProductCode());
    customer = customerRepository.findById(loanAccount.getCustomerId());
    customerPortFolioInsurancePremium = null;
    customerPortfolioInsuranceServiceCharge = null;
    customerPortfolioInsuranceServiceTax = null;
    spousePortFolioInsurancePremium = null;
    spousePortfolioInsuranceServiceCharge = null;
    spousePortfolioInsuranceServiceTax = null;
    gender = null;
    portfolioInsurancePremium = null;
    portfolioInsuranceUrn = (loanAccount.getPortfolioInsuranceUrn() == null || loanAccount.getPortfolioInsuranceUrn() == "") ? customer.getUrnNo() : loanAccount.getPortfolioInsuranceUrn();
    customerData = customerRepository.findByUrnNoAndCustomerStatusAndKgfsBankName(portfolioInsuranceUrn,user.getBankName());
    gender  = customerData.getGender();
    amount = loanAccount.getLoanAmount();
    insuranceType = "Individual";

    frequency = loanProduct.getFrequency().getDisplayName();
    noOfInstallments = Integer.parseInt(loanAccount.getTenure());

    factor=0;
    if(frequency.equals("Daily")){
        factor=applicationProperties.getFactor().getDailyFactor();
    }else if(frequency.equals("Weekly") || frequency.equals("EWI") ||
    frequency.equals("Weeks") || frequency.equals("Week") || frequency.equals("W")){
        factor=applicationProperties.getFactor().getWeeklyFactor();
    }else if(frequency.equals("Fortnightly") || frequency.equals("Fortnight") || frequency.equals("F") ){
        factor=applicationProperties.getFactor().getFortnightlyFactor();
    }else if(frequency.equals("Monthly") || frequency.equals("EMI")
    || frequency.equals("Months") || frequency.equals("Month") || frequency.equals("M")){
        factor=applicationProperties.getFactor().getMonthlyFactor();
    }else if(frequency.equals("quarterly")){
        factor=applicationProperties.getFactor().getQuarterlyFactor();
    }else if(frequency.equals("halfyearly") || frequency.equals("H")){
        factor=applicationProperties.getFactor().getHalfyearlyFactor();
    }else if(frequency.equals("annual") || frequency.equals("Year") || frequency.equals("Years") || frequency.equals("Y") || frequency.equals("Yearly")){
        factor=applicationProperties.getFactor().getAnnualFactor();
    }else if(frequency.equals("bullet")){
        factor=applicationProperties.getFactor().getBulletFactor();
    }

    double customerTenureInYear = (int)(noOfInstallments/factor);
    if (noOfInstallments%factor != 0) {

        customerTenureInYear++;
    }

    if(customerData == null || customerData.getDateOfBirth() == null) {
        feeCharge = "0".toBigDecimal();
    } else if(amount <= new BigDecimal ("1000")) {
        feeCharge = "0".toBigDecimal();
    }  else {
        LocalDate birthdate = customerData.getDateOfBirth();
        Period p = Period.between(birthdate, LocalDate.now());
        int age = p.getYears();
        List<String> femaleRate1 = new ArrayList<String>();
        femaleRate1.add("0.91");
        femaleRate1.add("0.91");
        femaleRate1.add("0.91");
        femaleRate1.add("0.91");
        femaleRate1.add("0.91");
        femaleRate1.add("0.91");
        femaleRate1.add("0.96");
        femaleRate1.add("0.98");
        femaleRate1.add("1.01");
        femaleRate1.add("1.03");
        femaleRate1.add("1.05");
        femaleRate1.add("1.06");
        femaleRate1.add("1.06");
        femaleRate1.add("1.07");
        femaleRate1.add("1.09");
        femaleRate1.add("1.1");
        femaleRate1.add("1.12");
        femaleRate1.add("1.14");
        femaleRate1.add("1.18");
        femaleRate1.add("1.22");
        femaleRate1.add("1.26");
        femaleRate1.add("1.32");
        femaleRate1.add("1.38");
        femaleRate1.add("1.46");
        femaleRate1.add("1.56");
        femaleRate1.add("1.66");
        femaleRate1.add("1.78");
        femaleRate1.add("1.92");
        femaleRate1.add("2.09");
        femaleRate1.add("2.28");
        femaleRate1.add("2.5");
        femaleRate1.add("2.75");
        femaleRate1.add("3.04");
        femaleRate1.add("3.37");
        femaleRate1.add("3.75");
        femaleRate1.add("4.18");
        femaleRate1.add("4.64");
        femaleRate1.add("5.14");
        femaleRate1.add("5.68");
        femaleRate1.add("6.23");
        femaleRate1.add("6.82");
        femaleRate1.add("7.42");
        femaleRate1.add("8.04");
        femaleRate1.add("8.68");
        femaleRate1.add("9.36");
        femaleRate1.add("10.08");
        femaleRate1.add("10.84");
        femaleRate1.add("0");
        femaleRate1.add("0");
        femaleRate1.add("0");
        femaleRate1.add("0");
        List<String> femaleRate2 = new ArrayList<String>();
        femaleRate2.add("2.27");
        femaleRate2.add("2.34");
        femaleRate2.add("2.4");
        femaleRate2.add("2.45");
        femaleRate2.add("2.5");
        femaleRate2.add("2.54");
        femaleRate2.add("2.57");
        femaleRate2.add("2.61");
        femaleRate2.add("2.63");
        femaleRate2.add("2.64");
        femaleRate2.add("2.66");
        femaleRate2.add("2.66");
        femaleRate2.add("2.66");
        femaleRate2.add("2.68");
        femaleRate2.add("2.75");
        femaleRate2.add("2.83");
        femaleRate2.add("2.95");
        femaleRate2.add("3.09");
        femaleRate2.add("3.27");
        femaleRate2.add("3.47");
        femaleRate2.add("3.69");
        femaleRate2.add("3.98");
        femaleRate2.add("4.3");
        femaleRate2.add("4.6");
        femaleRate2.add("4.9");
        femaleRate2.add("5.24");
        femaleRate2.add("5.66");
        femaleRate2.add("6.17");
        femaleRate2.add("6.76");
        femaleRate2.add("7.43");
        femaleRate2.add("8.19");
        femaleRate2.add("9.02");
        femaleRate2.add("9.94");
        femaleRate2.add("10.94");
        femaleRate2.add("12.02");
        femaleRate2.add("13.18");
        femaleRate2.add("14.43");
        femaleRate2.add("15.76");
        femaleRate2.add("17.16");
        femaleRate2.add("18.49");
        femaleRate2.add("19.87");
        femaleRate2.add("21.57");
        femaleRate2.add("23.59");
        femaleRate2.add("25.94");
        femaleRate2.add("28.6");
        femaleRate2.add("31.16");
        femaleRate2.add("34.03");
        femaleRate2.add("36.34");
        femaleRate2.add("39.16");
        femaleRate2.add("43.52");
        femaleRate2.add("48.32");
        List<String> femaleRate3 = new ArrayList<String>();
        femaleRate3.add("3.26");
        femaleRate3.add("3.35");
        femaleRate3.add("3.43");
        femaleRate3.add("3.52");
        femaleRate3.add("3.58");
        femaleRate3.add("3.63");
        femaleRate3.add("3.68");
        femaleRate3.add("3.72");
        femaleRate3.add("3.74");
        femaleRate3.add("3.76");
        femaleRate3.add("3.76");
        femaleRate3.add("3.78");
        femaleRate3.add("3.8");
        femaleRate3.add("3.86");
        femaleRate3.add("3.98");
        femaleRate3.add("4.12");
        femaleRate3.add("4.32");
        femaleRate3.add("4.54");
        femaleRate3.add("4.81");
        femaleRate3.add("5.12");
        femaleRate3.add("5.5");
        femaleRate3.add("5.92");
        femaleRate3.add("6.37");
        femaleRate3.add("6.82");
        femaleRate3.add("7.29");
        femaleRate3.add("7.85");
        femaleRate3.add("8.53");
        femaleRate3.add("9.32");
        femaleRate3.add("10.24");
        femaleRate3.add("11.28");
        femaleRate3.add("12.43");
        femaleRate3.add("13.7");
        femaleRate3.add("15.09");
        femaleRate3.add("16.61");
        femaleRate3.add("18.24");
        femaleRate3.add("19.99");
        femaleRate3.add("21.85");
        femaleRate3.add("23.84");
        femaleRate3.add("25.78");
        femaleRate3.add("27.81");
        femaleRate3.add("29.78");
        femaleRate3.add("32.13");
        femaleRate3.add("34.86");
        femaleRate3.add("37.98");
        femaleRate3.add("41.52");
        femaleRate3.add("45.44");
        femaleRate3.add("48.99");
        femaleRate3.add("53.16");
        femaleRate3.add("58.02");
        femaleRate3.add("64.59");
        femaleRate3.add("0");
        List<String> femaleRate4 = new ArrayList<String>();
        femaleRate4.add("4.21");
        femaleRate4.add("4.33");
        femaleRate4.add("4.44");
        femaleRate4.add("4.53");
        femaleRate4.add("4.6");
        femaleRate4.add("4.67");
        femaleRate4.add("4.73");
        femaleRate4.add("4.77");
        femaleRate4.add("4.8");
        femaleRate4.add("4.83");
        femaleRate4.add("4.83");
        femaleRate4.add("4.86");
        femaleRate4.add("4.91");
        femaleRate4.add("5.02");
        femaleRate4.add("5.19");
        femaleRate4.add("5.4");
        femaleRate4.add("5.68");
        femaleRate4.add("6.01");
        femaleRate4.add("6.37");
        femaleRate4.add("6.82");
        femaleRate4.add("7.34");
        femaleRate4.add("7.88");
        femaleRate4.add("8.47");
        femaleRate4.add("9.09");
        femaleRate4.add("9.76");
        femaleRate4.add("10.55");
        femaleRate4.add("11.51");
        femaleRate4.add("12.6");
        femaleRate4.add("13.87");
        femaleRate4.add("15.27");
        femaleRate4.add("16.84");
        femaleRate4.add("18.56");
        femaleRate4.add("20.44");
        femaleRate4.add("22.47");
        femaleRate4.add("24.64");
        femaleRate4.add("26.97");
        femaleRate4.add("29.31");
        femaleRate4.add("31.46");
        femaleRate4.add("33.71");
        femaleRate4.add("36.14");
        femaleRate4.add("38.86");
        femaleRate4.add("42.09");
        femaleRate4.add("45.85");
        femaleRate4.add("50.11");
        femaleRate4.add("54.89");
        femaleRate4.add("59.45");
        femaleRate4.add("64.7");
        femaleRate4.add("70.74");
        femaleRate4.add("77.66");
        femaleRate4.add("0");
        femaleRate4.add("0");
        List<String> femaleRate5 = new ArrayList<String>();
        femaleRate5.add("5.13");
        femaleRate5.add("5.26");
        femaleRate5.add("5.39");
        femaleRate5.add("5.49");
        femaleRate5.add("5.58");
        femaleRate5.add("5.65");
        femaleRate5.add("5.72");
        femaleRate5.add("5.76");
        femaleRate5.add("5.79");
        femaleRate5.add("5.82");
        femaleRate5.add("5.84");
        femaleRate5.add("5.9");
        femaleRate5.add("6.01");
        femaleRate5.add("6.17");
        femaleRate5.add("6.4");
        femaleRate5.add("6.69");
        femaleRate5.add("7.06");
        femaleRate5.add("7.48");
        femaleRate5.add("7.98");
        femaleRate5.add("8.56");
        femaleRate5.add("9.19");
        femaleRate5.add("9.86");
        femaleRate5.add("10.61");
        femaleRate5.add("11.41");
        femaleRate5.add("12.31");
        femaleRate5.add("13.36");
        femaleRate5.add("14.6");
        femaleRate5.add("16.02");
        femaleRate5.add("17.64");
        femaleRate5.add("19.45");
        femaleRate5.add("21.43");
        femaleRate5.add("23.61");
        femaleRate5.add("25.97");
        femaleRate5.add("28.5");
        femaleRate5.add("30.81");
        femaleRate5.add("33.36");
        femaleRate5.add("35.91");
        femaleRate5.add("38.59");
        femaleRate5.add("41.48");
        femaleRate5.add("44.66");
        femaleRate5.add("48.24");
        femaleRate5.add("52.43");
        femaleRate5.add("57.24");
        femaleRate5.add("62.67");
        femaleRate5.add("68.02");
        femaleRate5.add("74.16");
        femaleRate5.add("81.16");
        femaleRate5.add("89.1");
        femaleRate5.add("0");
        femaleRate5.add("0");
        femaleRate5.add("0");

        List<String> maleRate1 = new ArrayList<String>();
        maleRate1.add("0.91");
        maleRate1.add("0.96");
        maleRate1.add("0.98");
        maleRate1.add("1.01");
        maleRate1.add("1.03");
        maleRate1.add("1.05");
        maleRate1.add("1.06");
        maleRate1.add("1.06");
        maleRate1.add("1.07");
        maleRate1.add("1.09");
        maleRate1.add("1.1");
        maleRate1.add("1.12");
        maleRate1.add("1.14");
        maleRate1.add("1.18");
        maleRate1.add("1.22");
        maleRate1.add("1.26");
        maleRate1.add("1.32");
        maleRate1.add("1.38");
        maleRate1.add("1.46");
        maleRate1.add("1.56");
        maleRate1.add("1.66");
        maleRate1.add("1.78");
        maleRate1.add("1.92");
        maleRate1.add("2.09");
        maleRate1.add("2.28");
        maleRate1.add("2.5");
        maleRate1.add("2.75");
        maleRate1.add("3.04");
        maleRate1.add("3.37");
        maleRate1.add("3.75");
        maleRate1.add("4.18");
        maleRate1.add("4.64");
        maleRate1.add("5.14");
        maleRate1.add("5.68");
        maleRate1.add("6.23");
        maleRate1.add("6.82");
        maleRate1.add("7.42");
        maleRate1.add("8.04");
        maleRate1.add("8.68");
        maleRate1.add("9.36");
        maleRate1.add("10.08");
        maleRate1.add("10.84");
        maleRate1.add("11.67");
        maleRate1.add("12.58");
        maleRate1.add("13.57");
        maleRate1.add("14.67");
        maleRate1.add("15.88");
        maleRate1.add("0");
        maleRate1.add("0");
        maleRate1.add("0");
        maleRate1.add("0");

        List<String> maleRate2 = new ArrayList<String>();
        maleRate2.add("2.27");
        maleRate2.add("2.34");
        maleRate2.add("2.4");
        maleRate2.add("2.45");
        maleRate2.add("2.5");
        maleRate2.add("2.54");
        maleRate2.add("2.57");
        maleRate2.add("2.61");
        maleRate2.add("2.63");
        maleRate2.add("2.64");
        maleRate2.add("2.66");
        maleRate2.add("2.66");
        maleRate2.add("2.66");
        maleRate2.add("2.68");
        maleRate2.add("2.75");
        maleRate2.add("2.83");
        maleRate2.add("2.95");
        maleRate2.add("3.09");
        maleRate2.add("3.27");
        maleRate2.add("3.47");
        maleRate2.add("3.69");
        maleRate2.add("3.98");
        maleRate2.add("4.3");
        maleRate2.add("4.6");
        maleRate2.add("4.9");
        maleRate2.add("5.24");
        maleRate2.add("5.66");
        maleRate2.add("6.17");
        maleRate2.add("6.76");
        maleRate2.add("7.43");
        maleRate2.add("8.19");
        maleRate2.add("9.02");
        maleRate2.add("9.94");
        maleRate2.add("10.94");
        maleRate2.add("12.02");
        maleRate2.add("13.18");
        maleRate2.add("14.43");
        maleRate2.add("15.76");
        maleRate2.add("17.16");
        maleRate2.add("18.49");
        maleRate2.add("19.87");
        maleRate2.add("21.57");
        maleRate2.add("23.59");
        maleRate2.add("25.94");
        maleRate2.add("28.6");
        maleRate2.add("31.16");
        maleRate2.add("34.03");
        maleRate2.add("36.34");
        maleRate2.add("39.16");
        maleRate2.add("43.52");
        maleRate2.add("48.32");
        List<String> maleRate3 = new ArrayList<String>();
        maleRate3.add("3.26");
        maleRate3.add("3.35");
        maleRate3.add("3.43");
        maleRate3.add("3.52");
        maleRate3.add("3.58");
        maleRate3.add("3.63");
        maleRate3.add("3.68");
        maleRate3.add("3.72");
        maleRate3.add("3.74");
        maleRate3.add("3.76");
        maleRate3.add("3.76");
        maleRate3.add("3.78");
        maleRate3.add("3.8");
        maleRate3.add("3.86");
        maleRate3.add("3.98");
        maleRate3.add("4.12");
        maleRate3.add("4.32");
        maleRate3.add("4.54");
        maleRate3.add("4.81");
        maleRate3.add("5.12");
        maleRate3.add("5.5");
        maleRate3.add("5.92");
        maleRate3.add("6.37");
        maleRate3.add("6.82");
        maleRate3.add("7.29");
        maleRate3.add("7.85");
        maleRate3.add("8.53");
        maleRate3.add("9.32");
        maleRate3.add("10.24");
        maleRate3.add("11.28");
        maleRate3.add("12.43");
        maleRate3.add("13.7");
        maleRate3.add("15.09");
        maleRate3.add("16.61");
        maleRate3.add("18.24");
        maleRate3.add("19.99");
        maleRate3.add("21.85");
        maleRate3.add("23.84");
        maleRate3.add("25.78");
        maleRate3.add("27.81");
        maleRate3.add("29.78");
        maleRate3.add("32.13");
        maleRate3.add("34.86");
        maleRate3.add("37.98");
        maleRate3.add("41.52");
        maleRate3.add("45.44");
        maleRate3.add("48.99");
        maleRate3.add("53.16");
        maleRate3.add("58.02");
        maleRate3.add("64.59");
        maleRate3.add("0");
        List<String> maleRate4 = new ArrayList<String>();
        maleRate4.add("4.21");
        maleRate4.add("4.33");
        maleRate4.add("4.44");
        maleRate4.add("4.53");
        maleRate4.add("4.6");
        maleRate4.add("4.67");
        maleRate4.add("4.73");
        maleRate4.add("4.77");
        maleRate4.add("4.8");
        maleRate4.add("4.83");
        maleRate4.add("4.83");
        maleRate4.add("4.86");
        maleRate4.add("4.91");
        maleRate4.add("5.02");
        maleRate4.add("5.19");
        maleRate4.add("5.4");
        maleRate4.add("5.68");
        maleRate4.add("6.01");
        maleRate4.add("6.37");
        maleRate4.add("6.82");
        maleRate4.add("7.34");
        maleRate4.add("7.88");
        maleRate4.add("8.47");
        maleRate4.add("9.09");
        maleRate4.add("9.76");
        maleRate4.add("10.55");
        maleRate4.add("11.51");
        maleRate4.add("12.6");
        maleRate4.add("13.87");
        maleRate4.add("15.27");
        maleRate4.add("16.84");
        maleRate4.add("18.56");
        maleRate4.add("20.44");
        maleRate4.add("22.47");
        maleRate4.add("24.64");
        maleRate4.add("26.97");
        maleRate4.add("29.31");
        maleRate4.add("31.46");
        maleRate4.add("33.71");
        maleRate4.add("36.14");
        maleRate4.add("38.86");
        maleRate4.add("42.09");
        maleRate4.add("45.85");
        maleRate4.add("50.11");
        maleRate4.add("54.89");
        maleRate4.add("59.45");
        maleRate4.add("64.7");
        maleRate4.add("70.74");
        maleRate4.add("77.66");
        maleRate4.add("0");
        maleRate4.add("0");
        List<String> maleRate5 = new ArrayList<String>();
        maleRate5.add("5.13");
        maleRate5.add("5.26");
        maleRate5.add("5.39");
        maleRate5.add("5.49");
        maleRate5.add("5.58");
        maleRate5.add("5.65");
        maleRate5.add("5.72");
        maleRate5.add("5.76");
        maleRate5.add("5.79");
        maleRate5.add("5.82");
        maleRate5.add("5.84");
        maleRate5.add("5.9");
        maleRate5.add("6.01");
        maleRate5.add("6.17");
        maleRate5.add("6.4");
        maleRate5.add("6.69");
        maleRate5.add("7.06");
        maleRate5.add("7.48");
        maleRate5.add("7.98");
        maleRate5.add("8.56");
        maleRate5.add("9.19");
        maleRate5.add("9.86");
        maleRate5.add("10.61");
        maleRate5.add("11.41");
        maleRate5.add("12.31");
        maleRate5.add("13.36");
        maleRate5.add("14.6");
        maleRate5.add("16.02");
        maleRate5.add("17.64");
        maleRate5.add("19.45");
        maleRate5.add("21.43");
        maleRate5.add("23.61");
        maleRate5.add("25.97");
        maleRate5.add("28.5");
        maleRate5.add("30.81");
        maleRate5.add("33.36");
        maleRate5.add("35.91");
        maleRate5.add("38.59");
        maleRate5.add("41.48");
        maleRate5.add("44.66");
        maleRate5.add("48.24");
        maleRate5.add("52.43");
        maleRate5.add("57.24");
        maleRate5.add("62.67");
        maleRate5.add("68.02");
        maleRate5.add("74.16");
        maleRate5.add("81.16");
        maleRate5.add("89.1");
        maleRate5.add("0");
        maleRate5.add("0");
        maleRate5.add("0");

        for(int i=0; i<=68; i++){
            if(age == i+18 ) {
                if(gender.equalsIgnoreCase("FEMALE")){
                    if(customerTenureInYear == 1)
                        feeCharge = ((amount * new BigDecimal (femaleRate1.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 2)
                        feeCharge = ((amount * new BigDecimal (femaleRate2.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 3)
                        feeCharge = ((amount * new BigDecimal (femaleRate3.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 4)
                        feeCharge = ((amount * new BigDecimal (femaleRate4.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 5)
                        feeCharge = ((amount * new BigDecimal (femaleRate5.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                }else if(gender.equalsIgnoreCase("MALE")){

                    if(customerTenureInYear == 1)
                        feeCharge = ((amount * new BigDecimal (maleRate1.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 2)
                        feeCharge = ((amount * new BigDecimal (maleRate2.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 3)
                        feeCharge = ((amount * new BigDecimal (maleRate3.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 4)
                        feeCharge = ((amount * new BigDecimal (maleRate4.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                    else if(customerTenureInYear == 5)
                        feeCharge = ((amount * new BigDecimal (maleRate5.get(i)))/1000).setScale(2, BigDecimal.ROUND_HALF_UP);
                }
            }
        }
        customerPortFolioInsurancePremium = BigDecimal.valueOf( Math.round(feeCharge.doubleValue()));
    }
